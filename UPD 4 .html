<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FIND ME - Share Your Feedback</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <style>
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        @keyframes fadeInSlow {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        @keyframes slideDown {
            from { opacity: 0; transform: translate(-50%, -100%); }
            to { opacity: 1; transform: translate(-50%, 0); }
        }
        @keyframes scaleIn {
            from { opacity: 0; transform: scale(0.9); }
            to { opacity: 1; transform: scale(1); }
        }
        @keyframes slideUp {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fadeIn {
            animation: fadeIn 0.8s ease-out;
        }
        .animate-fadeInSlow {
            animation: fadeInSlow 1.2s ease-out 0.4s backwards;
        }
        .animate-slideDown {
            animation: slideDown 0.5s ease-out;
        }
        .animate-scaleIn {
            animation: scaleIn 0.7s ease-out;
        }
        .animate-slideUp {
            animation: slideUp 0.8s ease-out 0.8s backwards;
        }
        .hidden { display: none; }
    </style>
</head>
<body class="m-0 p-0 overflow-x-hidden">
    <div id="app" class="min-h-screen w-full relative overflow-hidden bg-gradient-to-br from-black via-purple-950 to-black">
        <!-- Animated background effects -->
        <div class="absolute inset-0 overflow-hidden pointer-events-none">
            <div class="absolute top-20 left-20 w-96 h-96 bg-purple-600/10 rounded-full blur-3xl animate-pulse"></div>
            <div class="absolute bottom-20 right-20 w-96 h-96 bg-purple-800/10 rounded-full blur-3xl animate-pulse" style="animation-delay: 1s;"></div>
        </div>

        <!-- Popup notifications -->
        <div id="popup" class="fixed top-8 left-1/2 transform -translate-x-1/2 z-50 hidden">
            <div id="popup-content" class="flex items-center gap-3 px-6 py-4 rounded-2xl backdrop-blur-xl shadow-2xl border">
                <svg id="popup-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="10"></circle>
                    <path d="M12 8v4m0 4h.01"></path>
                </svg>
                <span id="popup-text" class="font-medium"></span>
            </div>
        </div>

        <!-- Login Page -->
        <div id="login-page" class="absolute inset-0 flex items-center justify-center z-40 transition-all duration-700">
            <div class="relative animate-fadeIn">
                <div class="absolute inset-0 bg-gradient-to-r from-purple-600/30 to-pink-600/30 rounded-3xl blur-xl"></div>
                <div class="relative bg-black/40 backdrop-blur-2xl border border-white/10 rounded-3xl p-12 shadow-2xl">
                    <div class="flex flex-col items-center gap-8">
                        <div class="relative">
                            <div class="absolute inset-0 bg-purple-600/50 rounded-full blur-2xl"></div>
                            <div class="relative bg-gradient-to-br from-purple-600 to-purple-900 p-6 rounded-full">
                                <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2">
                                    <rect x="2" y="4" width="20" height="16" rx="2"></rect>
                                    <path d="m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7"></path>
                                </svg>
                            </div>
                        </div>
                        
                        <div class="text-center space-y-2">
                            <h1 class="text-4xl font-bold text-white">Welcome</h1>
                            <p class="text-gray-400">Share your thoughts with us</p>
                        </div>

                        <button id="google-login-btn" class="group relative flex items-center gap-4 px-8 py-4 bg-white/10 hover:bg-white/20 border border-white/20 rounded-2xl transition-all duration-300 hover:scale-105 hover:shadow-2xl hover:shadow-purple-500/20">
                            <div class="absolute inset-0 bg-gradient-to-r from-purple-600/0 via-purple-600/10 to-purple-600/0 rounded-2xl opacity-0 group-hover:opacity-100 transition-opacity"></div>
                            <svg class="w-6 h-6" viewBox="0 0 24 24">
                                <path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
                                <path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/>
                                <path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/>
                                <path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/>
                            </svg>
                            <span class="text-white font-medium">Continue with Google</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Page -->
        <div id="main-page" class="hidden relative z-10 min-h-screen flex flex-col items-center justify-between p-4 animate-scaleIn">
            <button id="logout-btn" class="absolute top-8 right-8 flex items-center gap-2 px-4 py-2 bg-white/5 hover:bg-white/10 border border-white/10 rounded-xl transition-all duration-300 text-gray-400 hover:text-white">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
                    <polyline points="16 17 21 12 16 7"></polyline>
                    <line x1="21" y1="12" x2="9" y2="12"></line>
                </svg>
                <span class="hidden sm:inline">Logout</span>
            </button>

            <div class="w-full max-w-2xl space-y-8 flex-grow flex flex-col justify-center py-16">
                <div class="text-center space-y-4 animate-fadeIn">
                    <h1 class="text-5xl sm:text-6xl font-bold text-white">Share Your Thoughts</h1>
                    <p class="text-gray-400 text-lg">We'd love to hear from you</p>
                </div>

                <!-- Welcome Message -->
                <div class="text-center px-4 animate-fadeInSlow">
                    <p class="text-white text-lg sm:text-xl md:text-2xl font-semibold leading-relaxed">
                        Hello Mr <span id="user-name" class="text-transparent bg-clip-text bg-gradient-to-r from-purple-400 to-pink-400">Guest</span>, 
                        I hope you are fine. I'm <span class="text-purple-400">Benry</span>, the developer of the game <span class="text-purple-400 font-bold">FIND ME</span>. 
                        I hope you are enjoying it. If you have anything to say, just type it below. 
                        I would love to hear any idea, opinion, or problem you have about the game.
                    </p>
                </div>

                <div class="relative animate-slideUp">
                    <div class="absolute inset-0 bg-gradient-to-r from-purple-600/20 to-pink-600/20 rounded-3xl blur-2xl"></div>
                    <div class="relative bg-black/40 backdrop-blur-2xl border border-white/10 rounded-3xl p-8 shadow-2xl">
                        <textarea id="message-input" placeholder="Type your message here..." class="w-full h-48 bg-white/5 border border-white/10 rounded-2xl p-6 text-white placeholder-gray-500 resize-none focus:outline-none focus:ring-2 focus:ring-purple-500/50 focus:border-purple-500/50 transition-all duration-300"></textarea>

                        <div class="mt-6 flex justify-end">
                            <button id="send-btn" class="group relative flex items-center gap-3 px-8 py-4 bg-gradient-to-r from-purple-600 to-purple-800 hover:from-purple-500 hover:to-purple-700 rounded-2xl transition-all duration-300 hover:scale-105 hover:shadow-2xl hover:shadow-purple-500/50">
                                <div class="absolute inset-0 bg-white/20 rounded-2xl opacity-0 group-hover:opacity-100 transition-opacity blur-xl"></div>
                                <span class="relative text-white font-semibold">Send Message</span>
                                <svg class="relative text-white group-hover:translate-x-1 transition-transform" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <line x1="22" y1="2" x2="11" y2="13"></line>
                                    <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
                                </svg>
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Footer -->
            <footer class="w-full py-6 animate-fadeIn">
                <p class="text-white text-sm text-center tracking-widest opacity-60 hover:opacity-100 transition-opacity duration-300">
                    © By Benry
                </p>
            </footer>
        </div>
    </div>

    <script>
        // State management
        let userData = null;
        let hasSubmitted = false;

        // DOM elements
        const loginPage = document.getElementById('login-page');
        const mainPage = document.getElementById('main-page');
        const googleLoginBtn = document.getElementById('google-login-btn');
        const logoutBtn = document.getElementById('logout-btn');
        const messageInput = document.getElementById('message-input');
        const sendBtn = document.getElementById('send-btn');
        const popup = document.getElementById('popup');
        const popupContent = document.getElementById('popup-content');
        const popupIcon = document.getElementById('popup-icon');
        const popupText = document.getElementById('popup-text');
        const userName = document.getElementById('user-name');

        // Google OAuth Configuration
        const GOOGLE_CLIENT_ID = '1002597152142-cjmou2f40aqjfdqk5fnejq70au6kqeoi.apps.googleusercontent.com';
        let tokenClient;

        // Initialize Google Sign-In when page loads
        window.onload = function() {
            // Initialize the token client with popup mode
            tokenClient = google.accounts.oauth2.initTokenClient({
                client_id: GOOGLE_CLIENT_ID,
                scope: 'https://www.googleapis.com/auth/userinfo.profile https://www.googleapis.com/auth/userinfo.email',
                ux_mode: 'popup',
                callback: async (response) => {
                    if (response.access_token) {
                        await fetchUserInfo(response.access_token);
                    } else {
                        showPopup('error', 'Login failed. Please try again.');
                    }
                },
            });

            // Also initialize the ID-based flow as backup
            google.accounts.id.initialize({
                client_id: GOOGLE_CLIENT_ID,
                callback: handleCredentialResponse,
                ux_mode: 'popup',
                auto_select: false,
                cancel_on_tap_outside: true
            });
        };

        // Fetch user info from Google API
        async function fetchUserInfo(accessToken) {
            try {
                const response = await fetch('https://www.googleapis.com/oauth2/v2/userinfo', {
                    headers: {
                        'Authorization': `Bearer ${accessToken}`
                    }
                });

                if (!response.ok) {
                    throw new Error('Failed to fetch user info');
                }

                const userInfo = await response.json();
                processUserLogin(userInfo);

            } catch (error) {
                console.error('Error fetching user info:', error);
                showPopup('error', 'Failed to get user information.');
            }
        }

        // Handle credential response (backup method)
        function handleCredentialResponse(response) {
            try {
                const userInfo = parseJwt(response.credential);
                processUserLogin(userInfo);
            } catch (error) {
                console.error('Login error:', error);
                showPopup('error', 'Login failed. Please try again.');
            }
        }

        // Process user login data
        function processUserLogin(userInfo) {
            const fullName = userInfo.name || 'User';
            const firstName = userInfo.given_name || fullName.split(' ')[0];
            const email = userInfo.email || '';
            const picture = userInfo.picture || '';

            userData = {
                name: fullName,
                firstName: firstName,
                email: email,
                picture: picture
            };

            // Update UI with user's name
            userName.textContent = firstName;

            // Transition to main page
            loginPage.style.opacity = '0';
            loginPage.style.transform = 'scale(0.95)';
            loginPage.style.pointerEvents = 'none';

            setTimeout(() => {
                loginPage.classList.add('hidden');
                mainPage.classList.remove('hidden');
            }, 700);
        }

        // Handle Google Login Response
        function handleGoogleLogin(response) {
            try {
                // Decode JWT token to get user info
                const userInfo = parseJwt(response.credential);
                
                // Extract user data
                const fullName = userInfo.name || 'User';
                const firstName = userInfo.given_name || fullName.split(' ')[0];
                const email = userInfo.email || '';
                const picture = userInfo.picture || '';

                userData = {
                    name: fullName,
                    firstName: firstName,
                    email: email,
                    picture: picture
                };

                // Update UI with user's name
                userName.textContent = firstName;

                // Transition to main page
                loginPage.style.opacity = '0';
                loginPage.style.transform = 'scale(0.95)';
                loginPage.style.pointerEvents = 'none';

                setTimeout(() => {
                    loginPage.classList.add('hidden');
                    mainPage.classList.remove('hidden');
                }, 700);

            } catch (error) {
                console.error('Login error:', error);
                showPopup('error', 'Login failed. Please try again.');
            }
        }

        // Parse JWT token
        function parseJwt(token) {
            try {
                const base64Url = token.split('.')[1];
                const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
                const jsonPayload = decodeURIComponent(atob(base64).split('').map(function(c) {
                    return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
                }).join(''));
                return JSON.parse(jsonPayload);
            } catch (error) {
                console.error('JWT parse error:', error);
                return {};
            }
        }

        // Show popup notification
        function showPopup(type, text) {
            popup.classList.remove('hidden');
            popup.classList.add('animate-slideDown');
            
            if (type === 'error') {
                popupContent.className = 'flex items-center gap-3 px-6 py-4 rounded-2xl backdrop-blur-xl shadow-2xl border bg-red-500/20 border-red-500/50 text-red-200';
                popupIcon.innerHTML = '<circle cx="12" cy="12" r="10"></circle><line x1="15" y1="9" x2="9" y2="15"></line><line x1="9" y1="9" x2="15" y2="15"></line>';
            } else {
                popupContent.className = 'flex items-center gap-3 px-6 py-4 rounded-2xl backdrop-blur-xl shadow-2xl border bg-green-500/20 border-green-500/50 text-green-200';
                popupIcon.innerHTML = '<path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path><polyline points="22 4 12 14.01 9 11.01"></polyline>';
            }
            
            popupText.textContent = text;
            
            setTimeout(() => {
                popup.classList.add('hidden');
            }, 3000);
        }

        // Custom Google Login Button Handler
        googleLoginBtn.addEventListener('click', () => {
            // Show loading state
            const originalHTML = googleLoginBtn.innerHTML;
            googleLoginBtn.disabled = true;
            googleLoginBtn.innerHTML = '<span class="text-white font-medium">Opening...</span>';

            // Request access token - this will always show account picker
            try {
                tokenClient.requestAccessToken({ prompt: 'select_account' });
                
                // Reset button after a short delay
                setTimeout(() => {
                    googleLoginBtn.disabled = false;
                    googleLoginBtn.innerHTML = originalHTML;
                }, 2000);
            } catch (error) {
                console.error('Error opening Google login:', error);
                googleLoginBtn.disabled = false;
                googleLoginBtn.innerHTML = originalHTML;
                showPopup('error', 'Failed to open Google login. Please try again.');
            }
        });

        // Logout Handler
        logoutBtn.addEventListener('click', () => {
            userData = null;
            hasSubmitted = false;
            messageInput.value = '';
            messageInput.disabled = false;
            messageInput.placeholder = 'Type your message here...';
            sendBtn.disabled = false;
            
            mainPage.classList.add('hidden');
            loginPage.classList.remove('hidden');
            loginPage.style.opacity = '1';
            loginPage.style.transform = 'scale(1)';
            loginPage.style.pointerEvents = 'auto';
            
            googleLoginBtn.disabled = false;
            googleLoginBtn.innerHTML = '<div class="absolute inset-0 bg-gradient-to-r from-purple-600/0 via-purple-600/10 to-purple-600/0 rounded-2xl opacity-0 group-hover:opacity-100 transition-opacity"></div><svg class="w-6 h-6" viewBox="0 0 24 24"><path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/><path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/><path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/><path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/></svg><span class="text-white font-medium">Continue with Google</span>';
        });

        // Send Message Handler
        sendBtn.addEventListener('click', async () => {
            if (hasSubmitted) return;

            const message = messageInput.value.trim();
            
            if (!message) {
                showPopup('error', 'Write something first!');
                return;
            }

            // Disable button during send
            sendBtn.disabled = true;
            const originalHTML = sendBtn.innerHTML;
            sendBtn.innerHTML = '<span class="relative text-white font-semibold">Sending...</span>';

            try {
                // Send to Formspree
                const response = await fetch('https://formspree.io/f/mwpaeojq', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    },
                    body: JSON.stringify({
                        name: userData?.name || 'Anonymous',
                        email: userData?.email || 'no-email@provided.com',
                        message: message,
                        firstName: userData?.firstName || 'Guest',
                        timestamp: new Date().toISOString()
                    })
                });

                if (!response.ok) {
                    throw new Error('Failed to send message');
                }

                // Success
                hasSubmitted = true;
                showPopup('success', 'Thanks for your opinion!');
                messageInput.value = '';
                messageInput.disabled = true;
                messageInput.placeholder = "Thank you! You've already submitted your feedback.";
                messageInput.classList.add('opacity-50', 'cursor-not-allowed');
                
                // Keep button disabled
                sendBtn.innerHTML = '<span class="relative text-white font-semibold opacity-50">Sent ✓</span>';
                
            } catch (error) {
                console.error('Send error:', error);
                showPopup('error', 'Failed to send. Please try again.');
                sendBtn.disabled = false;
                sendBtn.innerHTML = originalHTML;
            }
        });

        // Enter key to send
        messageInput.addEventListener('keydown', (e) => {
            if (e.key === 'Enter' && e.ctrlKey) {
                sendBtn.click();
            }
        });
    </script>
</body>
</html>